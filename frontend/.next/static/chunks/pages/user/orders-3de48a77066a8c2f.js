(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[122],{3243:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user/orders",function(){return a(1051)}])},1051:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return S}});var r=a(567),n=a(5893),c=a(7294),l=a(5675),i=a.n(l),d=a(9008),o=a.n(d),m=a(1664),x=a.n(m),h=a(1163),u=a(6162),p=a(4910),g=a(5407),j=a(1429),v=a(9711),N=a(807),f=a(4874),b=a(2490),y=a(1837),w=a(7066),k=a(6501),_=a(9274);function S(){let e=(0,h.useRouter)(),{user:s,isAuthenticated:a,loading:l}=(0,b.a)(),d=e=>"$".concat(e.toFixed(2)),m=e=>new Date(e).toLocaleDateString(),{mounted:S}=(0,y.F)(),[C,Z]=(0,c.useState)([]),[A,O]=(0,c.useState)(!0),[E,D]=(0,c.useState)("all"),[F,P]=(0,c.useState)(1),[T,I]=(0,c.useState)(1),L=l||A||!S;(0,c.useEffect)(()=>{if(S&&!l&&!a){k.Am.error("You must be logged in to view orders."),e.push("/auth/login");return}},[a,l,S,e]),(0,c.useEffect)(()=>{s&&S&&!l&&R()},[s,S,l,R]);let R=(0,c.useCallback)(async()=>{try{O(!0),(0,r._)({page:F,limit:10},"all"!==E&&{status:E});let s=localStorage.getItem("token"),a=[],n=!1;try{var e;let r=await w.Z.get("".concat("https://fenkparet-backend.onrender.com","/api/orders/my-orders"),{headers:{Authorization:"Bearer ".concat(s)}});a=r.data.orders||[],n=!0,I((null===(e=r.data.pagination)||void 0===e?void 0:e.pages)||1)}catch(e){console.log("Server orders not available, checking local orders...")}let c=JSON.parse(localStorage.getItem("localOrders")||"[]"),l="all"===E?c:c.filter(e=>e.status===E),i=[...a,...l];i.sort((e,s)=>new Date(s.createdAt)-new Date(e.createdAt)),Z(i),!n&&c.length>0&&k.Am.success("Affichage de ".concat(c.length," commande(s) locale(s)"))}catch(e){console.error("Error fetching orders:",e),k.Am.error("Failed to load orders.")}finally{O(!1)}},[F,E]),X=e=>{switch(e){case"pending":case"payment-pending":return(0,n.jsx)(u.Z,{className:"w-5 h-5 text-warning-color"});case"confirmed":case"processing":return(0,n.jsx)(p.Z,{className:"w-5 h-5 text-info-color"});case"shipped":return(0,n.jsx)(g.Z,{className:"w-5 h-5 text-primary-color"});case"delivered":return(0,n.jsx)(j.Z,{className:"w-5 h-5 text-success-color"});case"cancelled":return(0,n.jsx)(v.Z,{className:"w-5 h-5 text-error-color"});default:return(0,n.jsx)(u.Z,{className:"w-5 h-5 text-theme-tertiary"})}},Y=e=>{switch(e){case"pending":case"payment-pending":return"badge-warning";case"confirmed":case"processing":return"badge-info";case"shipped":return"badge-primary";case"delivered":return"badge-success";case"cancelled":return"badge-danger";default:return"badge-secondary"}};return L?(0,n.jsx)(_.h,{message:"Loading your orders..."}):s?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(o(),{children:[(0,n.jsx)("title",{children:"My Orders | Fenkparet"}),(0,n.jsx)("meta",{name:"description",content:"View your order history and track your purchases from Fenkparet."}),(0,n.jsx)("meta",{name:"robots",content:"noindex, nofollow"})]}),(0,n.jsx)("div",{className:"min-h-screen bg-theme-primary py-8 theme-transition",children:(0,n.jsxs)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsx)("h1",{className:"text-3xl font-bold text-theme-primary",children:"Order History"}),(0,n.jsx)("p",{className:"text-theme-secondary mt-2",children:"Track and manage your orders"})]}),(0,n.jsx)("div",{className:"mb-6",children:(0,n.jsx)("div",{className:"flex flex-wrap gap-2",children:[{value:"all",label:"All Orders"},{value:"pending",label:"Pending"},{value:"payment-pending",label:"Payment Pending"},{value:"confirmed",label:"Confirmed"},{value:"processing",label:"Processing"},{value:"shipped",label:"Shipped"},{value:"delivered",label:"Delivered"},{value:"cancelled",label:"Cancelled"}].map(e=>(0,n.jsx)("button",{onClick:()=>{D(e.value),P(1)},className:"px-4 py-2 rounded-md text-sm font-medium transition-colors ".concat(E===e.value?"bg-accent text-accent-contrast":"bg-theme-tertiary text-theme-secondary border border-theme hover:bg-theme-secondary hover:text-theme-primary"),children:e.label},e.value))})}),(0,n.jsx)("div",{className:"space-y-6",children:A?(0,n.jsxs)("div",{className:"text-center py-12",children:[(0,n.jsx)("div",{className:"spinner w-8 h-8 text-accent mx-auto"}),(0,n.jsx)("p",{className:"text-theme-secondary mt-4",children:"Loading orders..."})]}):0===C.length?(0,n.jsxs)("div",{className:"text-center py-12 card",children:[(0,n.jsx)(N.Z,{className:"w-16 h-16 text-theme-tertiary mx-auto mb-4"}),(0,n.jsx)("h3",{className:"text-lg font-medium text-theme-primary mb-2",children:"No Orders Found"}),(0,n.jsx)("p",{className:"text-theme-secondary mb-6",children:"You haven't placed any orders yet."}),(0,n.jsx)(x(),{href:"/products",className:"btn-primary",children:"Start Shopping"})]}):C.map(e=>{var s,a;return(0,n.jsx)("div",{className:"card",children:(0,n.jsx)("div",{className:"card-body",children:(0,n.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between",children:[(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-4 mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[X(e.status),(0,n.jsxs)("span",{className:"font-medium text-theme-primary",children:["#",e.orderNumber]})]}),(0,n.jsx)("span",{className:"badge ".concat(Y(e.status)),children:t("order.status.".concat(e.status))||e.status})]}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-theme-secondary",children:"order.orderDate"}),(0,n.jsx)("p",{className:"font-medium text-theme-primary",children:m(e.createdAt)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-theme-secondary",children:"order.orderTotal"}),(0,n.jsx)("p",{className:"font-medium text-theme-primary",children:d(e.pricing.total)})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("p",{className:"text-sm text-theme-secondary",children:"order.itemsCount"}),(0,n.jsxs)("p",{className:"font-medium text-theme-primary",children:[e.items.length," ",1===e.items.length?"common.item":"common.items"]})]})]}),(0,n.jsx)("div",{className:"border-t border-theme pt-4",children:(0,n.jsxs)("div",{className:"space-y-2",children:[e.items.slice(0,2).map((e,s)=>{var a,r,c,l;return(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,n.jsx)("div",{className:"w-12 h-12 bg-theme-secondary rounded-md flex items-center justify-center",children:(null===(c=e.product)||void 0===c?void 0:null===(r=c.images)||void 0===r?void 0:null===(a=r[0])||void 0===a?void 0:a.url)?(0,n.jsx)(i(),{src:e.product.images[0].url,alt:e.product.name,width:48,height:48,className:"w-full h-full object-cover rounded-md"}):(0,n.jsx)(N.Z,{className:"w-6 h-6 text-theme-tertiary"})}),(0,n.jsxs)("div",{className:"flex-1",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-theme-primary",children:(null===(l=e.product)||void 0===l?void 0:l.name)||"common.product"}),(0,n.jsxs)("p",{className:"text-sm text-theme-secondary",children:["Qty: ",e.quantity," \xd7 ",d(e.price)]})]})]},s)}),e.items.length>2&&(0,n.jsxs)("p",{className:"text-sm text-theme-secondary",children:["+",e.items.length-2," ","order.moreItems"]})]})})]}),(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3 mt-6 lg:mt-0 lg:ml-6",children:[(0,n.jsxs)(x(),{href:"/orders/".concat(e._id),className:"btn-outline btn-sm inline-flex items-center",children:[(0,n.jsx)(f.Z,{className:"w-4 h-4 mr-2"}),"order.orderDetails"]}),"shipped"===e.status&&e.trackingNumber&&(0,n.jsxs)("button",{onClick:()=>{window.open("/track/".concat(e.trackingNumber),"_blank")},className:"btn-primary btn-sm inline-flex items-center",children:[(0,n.jsx)(g.Z,{className:"w-4 h-4 mr-2"}),"order.trackOrder"]}),"delivered"===e.status&&(0,n.jsx)(x(),{href:"/products/".concat(null===(a=e.items[0])||void 0===a?void 0:null===(s=a.product)||void 0===s?void 0:s._id,"?review=true"),className:"btn-secondary btn-sm",children:"order.writeReview"})]})]})})},e._id)})}),T>1&&(0,n.jsx)("div",{className:"mt-8 flex justify-center",children:(0,n.jsxs)("div",{className:"pagination",children:[(0,n.jsx)("button",{onClick:()=>P(F-1),disabled:1===F,className:"pagination-item",children:"common.previous"}),[...Array(T)].map((e,s)=>(0,n.jsx)("button",{onClick:()=>P(s+1),className:"pagination-item ".concat(F===s+1?"active":""),children:s+1},s+1)),(0,n.jsx)("button",{onClick:()=>P(F+1),disabled:F===T,className:"pagination-item",children:"common.next"})]})})]})})]}):null}}},function(e){e.O(0,[216,888,179],function(){return e(e.s=3243)}),_N_E=e.O()}]);